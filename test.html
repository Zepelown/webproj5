<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>주소로 장소 표시하기</title>

</head>

<body>
    <div id="map" style="width:100%;height:100vh;"></div>
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=12786a1d8a1d108c13cd2dc568bc51e4&libraries=services"></script>
    <script>
        const url = "https://api.odcloud.kr/api/3070044/v1/uddi:1da04db6-8d95-480b-902c-f9316c705379_201906211646?page=1&perPage=300&returnType=JSON&serviceKey=muAzQmFBf9gOEiqBbNkzMbOmlHV9zPkNCrLf6FsdrOzZsUnb%2BPm84EInw0N1bZmrpTEGEdkXbmRRBi0cRq%2BhRA%3D%3D";

        function mouseOverListener(map, marker, infoWindow) {
            return function () {
                infoWindow.open(map, marker);
            };
        }
        function mouseOutListener(infoWindow) {
            return function () {
                infoWindow.close();
            };
        }
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(35.13417, 129.11397), // 지도의 중심좌표
                level: 10 // 지도의 확대 레벨
            };



        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption);


        fetch(url)
            .then((res) => res.json())
            .then((resJson) => {
                var markers = [];
                // 급경사지 좌표 리스트
                var centers = resJson.data;
                // 빨간색 마커로 표시
                var markerImage_red = new kakao.maps.MarkerImage(
                    'https://cdn.pixabay.com/photo/2014/04/02/10/45/location-304467_960_720.png',
                    new kakao.maps.Size(24, 34),
                    {
                        offset: new kakao.maps.Point(13, 34),
                    }
                );
                for (let i = 0; i < centers.length; i++) {
                    //const contents = resJson.getFcltsDsgstInfo.body.items.item[i].contents;

                    // Extract the address part
                    var geocoder = new kakao.maps.services.Geocoder();
                    const address = centers[i]["위치"];
                    console.log(address);
                    // 주소로 좌표를 검색합니다
                    geocoder.addressSearch(address, function (result, status) {

                        // 정상적으로 검색이 완료됐으면 
                        if (status === kakao.maps.services.Status.OK) {

                            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                            // 결과값으로 받은 위치를 마커로 표시합니다
                            var marker = new kakao.maps.Marker({
                                map: map,
                                position: coords,
                                image: markerImage_red // 빨간색 마커로 표시
                            });

                            // 인포윈도우로 장소에 대한 설명을 표시합니다
                            var infoWindow = new kakao.maps.InfoWindow({
                                content: centers[i]["급경사지명"],
                            });
                            infoWindow.open(map, marker);
       
                            kakao.maps.event.addListener(marker, "mouseover", mouseOverListener(map, marker, infoWindow));
                            kakao.maps.event.addListener(marker, "mouseout", mouseOutListener(infoWindow));
                        }
                    });
                }
            });
            
    </script>
</body>

</html>