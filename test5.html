<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>주소로 장소 표시하기</title>

</head>

<body>
    <div id="map" style="width:100%;height:600px;"></div>

    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=48bf9c9621d5f297a462adb46cba2f1b&libraries=services,clusterer"></script>
    <!--<script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=48bf9c9621d5f297a462adb46cba2f1b&libraries=clusterer"></script>-->

    <script>

        const url = 'https://apis.data.go.kr/6260000/BusanFcltsDsgstInfoService/getFcltsDsgstInfo?serviceKey=UE%2BeS7fd%2BJ6hfdwYzoLAyI01f%2BSlk8KcJxBe1jW5ozgmWIkaURAsJ3uu0N4esvtfjuCmYeZAMwv5vgT0NWyNqA%3D%3D&numOfRows=687&pageNo=1&resultType=json';

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(35.13417, 129.11397), // 지도의 중심좌표
                level: 9 // 지도의 확대 레벨
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption);


        fetch(url)
            .then(res => res.json())
            .then(resJson => {

                var markers = [];

                for (var i = 0; i < 687; i++) {

                    const contents = resJson.getFcltsDsgstInfo.body.items.item[i].contents;

                    // Extract the address part
                    const startIndex = contents.indexOf("2.");
                    const endIndex = contents.indexOf("<", startIndex);
                    let address = contents.substring(startIndex, endIndex).trim();

                    // Remove the "2." and "Address:" parts
                    address = address.replace(/2\.\s*주\s*소 : ?/i, "").trim();

                    console.log(address);
                    // or assign it to an HTML element
                    // element.innerHTML = address;


                    // 주소-좌표 변환 객체를 생성합니다
                    var geocoder = new kakao.maps.services.Geocoder();

                    // 주소로 좌표를 검색합니다
                    geocoder.addressSearch(address, function (result, status) {

                        // 정상적으로 검색이 완료됐으면 
                        if (status === kakao.maps.services.Status.OK) {

                            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                            // 결과값으로 받은 위치를 마커로 표시합니다
                            var marker = new kakao.maps.Marker({
                                map: map,
                                position: coords
                            });

                            markers.push(marker);

                            // 인포윈도우로 장소에 대한 설명을 표시합니다
                            //var infowindow = new kakao.maps.InfoWindow({
                            //    content: '<div style="width:150px;text-align:center;padding:6px 0;">' + address + '</div>'
                            //});
                            //infowindow.open(map, marker);

                            // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                            //map.setCenter(coords);
                        }

                        // If all markers have been created
                        if (markers.length === 500) {
                            // Create a marker clusterer
                            var clusterer = new kakao.maps.MarkerClusterer({
                                map: map,
                                markers: markers,
                                gridSize: 50,
                                averageCenter: true,
                                minLevel: 4
                            });
                        }
                    });

                }

                console.log(markers);
                console.log(markers.length);
            })

    </script>
</body>

</html>